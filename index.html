<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>마커에 인포윈도우 표시하기</title>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        #map {
            position: relative;
            width: 100%;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div id="map"></div>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=e3b280d2b743d5969774693f4f482db7"></script>
<script>

    
    /************************************************************************************************
     * 기본적으로 xml로 리턴되는 API들이니까
     * 우선 실시간 병상 정보를 불러오고 https://apis.data.go.kr/B552657/ErmctInfoInqireService/getEmrrmRltmUsefulSckbdInfoInqire?serviceKey=6N1JeuU2GFvmzRpDpgjpymP4hREckoNOTCBysivZs3BakGZwtFTvdBNyf3e50vP8BaFH9O4GALYgNiUaHLIuUA%3D%3D&STAGE1=%EC%84%9C%EC%9A%B8%ED%8A%B9%EB%B3%84%EC%8B%9C&pageNo=1&numOfRows=100
     * 병상 정보에서 hpid (병원 고유 번호)를 파라미터로 병원의 기본정보를 불러온다 https://apis.data.go.kr/B552657/ErmctInfoInqireService/getEgytBassInfoInqire?serviceKey=6N1JeuU2GFvmzRpDpgjpymP4hREckoNOTCBysivZs3BakGZwtFTvdBNyf3e50vP8BaFH9O4GALYgNiUaHLIuUA%3D%3D&HPID=A1100015&pageNo=1&numOfRows=10
     * 기본정보의 위도 경도로 마커를 찍고 병원 이름, 병원 주소, 전화번호, 실시간 병상 정보를 기입한다.
     * **********************************************************************************************
    */



    var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
        mapOption = { 
            center: new kakao.maps.LatLng(37.5366059, 126.9771397), // 지도의 중심좌표
            level: 14 // 지도의 확대 레벨
        };

    var map = new kakao.maps.Map(mapContainer, mapOption); // 지도 생성
    

    // API로 병원정보 가져오기 (시민건강국 보건의료정책과 제공)
    const url = 'http://openapi.seoul.go.kr:8088/6c726346796162673738594676554d/json/TvEmgcHospitalInfo/1/70';
    


    fetch(url)
    .then(result => result.json())   // json 파일을 객체로 변환
    .then(json => {                     
      //console.log(json);              
      const data = json.TvEmgcHospitalInfo.row;  // 객체에서 실제 내용만 data로 저장   
      console.log(data);

        // 마커들을 모아놓을 변수
        var markers = [];

        for(let i = 0; i < data.length; i++) {  
        // 마커를 생성합니다
        var marker = new kakao.maps.Marker({
            map: map,
            position: new kakao.maps.LatLng(data[i].WGS84LAT, data[i].WGS84LON)
        });

            // 마커에 mouseover 이벤트와 mouseout 이벤트를 등록합니다
            // 이벤트 리스너로는 클로저를 만들어 등록합니다 
            // for문에서 클로저를 만들어 주지 않으면 마지막 마커에만 이벤트가 등록됩니다
            kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
            kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
        }

        // 인포윈도우를 표시하는 클로저를 만드는 함수입니다 
        function makeOverListener(map, marker, infowindow) {
            return function() {
                infowindow.open(map, marker);
            };
        }

        // 인포윈도우를 닫는 클로저를 만드는 함수입니다 
        function makeOutListener(infowindow) {
            return function() {
                infowindow.close();
            };
        }
    });


</script>
</body>
</html>